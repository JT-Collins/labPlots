---
title: "Lab style plots"
author: "J. Collins"
date: '2022-06-24'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.retina = 1)

```

## Lab Style

last updated "`r Sys.Date()`"

This repo contains the functions of the `labPlots` package, which once installed locally, provides helpful functions for creating graphics made in ggplot in the style used by the Collins Lab. The package and this doc borrows (steals) heavily from the bbplots package.

## Load all the libraries you need

A few of the steps in this cookbook - and to create charts in R in general - require certain packages to be installed and loaded. So that you do not have to install and load them one by one, you can use the p_load function in the pacman package to load them all at once with the following code.

```{r}
#This line of code installs the pacman page if you do not have it installed - if you do, it simply loads the package

if(!require(pacman))install.packages("pacman")

pacman::p_load('dplyr', 'tidyr', 'gapminder',
               'ggplot2',  'ggalt', 'ragg',
               'forcats', 'R.utils', 'png', 
               'grid', 'ggpubr', 'scales',
               'labPlots')
```

## Installing labPlots package

`labPlots` is not on CRAN, so you will have to install it directly from Github using `devtools`. 

If you do not have the `devtools` package installed, you will have to run the first line in the code below as well. 

```
# install.packages("devtools")
devtools::install_github("JT-Collins/labPlots")
```

## Seting up font and colours
Depending on the plot you may need to change the colours used, however, as a default we will use the UofL colour palette. We will also use a different font. Both of these things need to be set at the start of the script - simply copy and run the code!

<!-- ```{r} -->
<!-- # Set font options -------------------------------------------------------- -->

<!-- sysfonts::font_add(family = "assistant", -->
<!--          regular = "~/Box/Lab Docs/R projects/aesthetics/fonts/Assistant-Regular.otf", -->
<!--          italic = "~/Box/Lab Docs/R projects/aesthetics/fonts/SourceSansPro-Italic.ttf", -->
<!--          bold = "~/Box/Lab Docs/R projects/aesthetics/fonts/Assistant-SemiBold.otf") -->

<!-- showtext::showtext_auto(enable = TRUE) -->


<!-- # Set colour options ------------------------------------------------------ -->
<!-- uofl_col <- c("#8B9DA1", "#AD0000", "#004E74", "#FEBE10" ,"#00A89D","#7A6C53",  "#AAB43A", "#D9C982") -->
<!-- options(ggplot2.continuous.colour="viridis") -->
<!-- options(ggplot2.continuous.fill = "viridis") -->
<!-- options(ggplot2.discrete.colour = uofl_col ) -->
<!-- options(ggplot2.discrete.fill = uofl_col ) -->
<!-- ``` -->




## How does the labPlot package work?
The package has just one function, lab_style().

lab_style(): has no arguments and is added to the ggplot ‘chain’ after you have created a plot. What it does is generally makes text size, font and colour, axis lines, axis text, margins and many other standard chart components into Lab style.

Note that colours for lines in the case of a line chart or bars for a bar chart, are based on the UofL colour scheme but can be set to other colours where needed.

The code below shows how the lab_style() should be used within standard chart-production workflow. This is an example for a very simple line chart, using data from the gapminder package.

```{r}
#Data for chart from gapminder package
line_df <- gapminder %>%
  filter(country == "Malawi") 

#Make plot
line <- ggplot(line_df, aes(x = year, y = lifeExp,colour = country)) +
  geom_line( size = 1.2) +
  lab_style() +
  theme(legend.position = "none") + # removes legend - default is legend on the right
  ylim(0,50) +
  labs(title="Living longer",
       subtitle = "Life expectancy in Malawi 1952-2007") +
  NULL
```

```{r, echo=FALSE, message = FALSE, warning = FALSE, fig.dim = c(8, 5)}
line
```

It is possible to alter every aspect of a ggplot. Often you may have to change a couple of things, its important to do this after the call to the `lab_style()` function. If you do it before the `lab_style()` will override it.

For example, this will add some gridlines, by adding extra theme arguments to what is included in the lab_style() function. There are many similar examples throughout the cookbook.

```{r, echo=T, results='hide'}
theme(panel.grid.major.y = element_line(color="#cbcbcb"))
```


```{r, echo=FALSE, message = FALSE, warning = FALSE}
line + theme(panel.grid.major.y = element_line(color="#cbcbcb"))
```

## Save out your finished chart
After adding the lab_style() to your chart there is one more step to get your plot ready for publication: ggsave(). this will save it to your specified location. The function has several arguments:

Here are the function arguments: ggsave(plot_name, save_filepath, device = ragg::agg_png, res = 300, scaling = 1, width = x, height = x, units = "in")

`plot_name`: the variable name that you have called your plot, for example for the chart example above plot_name would be "line". You can also leave this blank and ggsave will save the last plot.
`save_filepath`: the precise filepath that you want your graphic to save to, including the `.png` extension at the end. This does depend on your working directory and if you are in a specific R project. An example filepath would be: `Desktop/R_projects/charts/line_chart.png`
`width, height, units`: Plot size in units ("in", "cm", "mm", or "px"). If not supplied, uses the size of current graphics device.
`device`: `agg_png` provides improved saving and scaling for png files.
`res`: the resolution of the figure.

more information can be found by typing `?ggsave()` into the console.

Once you have created your plot and are relatively happy with it, you can use the ggsave() function to make the final adjustments and save out your chart so that you can look at it outside RStudio.

It is important to mention that it is a good idea to do this early on because the position of the text and other elements do not render accurately in the RStudio Plots panel because this depends on the size and aspect ratio you want your plot to appear, so saving it out and opening up the files give you an accurate representation of how the graphic looks.

## Make a line chart

```{r}
#Prepare data
line_df <- gapminder |>
  filter(country == "Italy") 

#Make plot
line <- ggplot(line_df, aes(x = year, y = lifeExp, colour = country)) +
  geom_line(size = 1.2) +
  lab_style() +
  theme(legend.position = "none") + # removes legend - default is legend on the right
  scale_y_continuous(limits = c(0,85), expand = c(0, 0)) + # limits sets y axis limits and expand removes white space (compare to previos plot). Feel free to delete this to see the default behaviour!
  labs(title="Living longer",
       subtitle = "Life expectancy in Italy 1952-2007",
       caption = "Data from gapmider package") +
  
  NULL

```


```{r, echo=FALSE, message = FALSE, warning = FALSE}
line
```

## Make a multiple line chart

```{r}
#Prepare data
multiple_line_df <- gapminder %>%
  filter(country == "Italy" | country == "United States") 

#Make plot
multiple_line <- ggplot(multiple_line_df, aes(x = year, y = lifeExp, colour = country)) +
  geom_line(size = 1) +
  geom_hline(yintercept = 0, size = 1, colour="#333333") +
  scale_colour_manual(values = c("#FAAB18", "#1380A1")) +
  lab_style() +
  labs(title="Living longer",
       subtitle = "Life expectancy in China and the US")
```


```{r, echo=FALSE, message = FALSE, warning = FALSE}
multiple_line
```
